!function(){function r(r,n,t){var e,u,o=n.x,a=n.y,i=o.length,f=a.length;for(e=0;f>e;e++)for(u=0;i>u;u++)r[i*e+u]=t(o[e],a[u]);return r}function n(r,n){if("number"==typeof r)return Math.abs(r-n);var t,e=r.length,u=0;for(t=0;e>t;t++)u+=Math.abs(r[t]-n[t]);return u}function t(r,n){if("number"==typeof r)return Math.abs(r-n);var t,e=r.length,u=0;for(t=0;e>t;t++)u+=(r[t]-n[t])*(r[t]-n[t]);return Math.sqrt(u)}function e(r,n){if("number"==typeof r)return Math.abs(r-n);var t,e=r.length,u=[];for(t=0;e>t;t++)u.push(Math.abs(r[t]-n[t]));return Math.max.apply(null,u)}function u(r,n){if("number"==typeof r)return Math.abs(r-n);var t,e=r.length,u=[];for(t=0;e>t;t++)u.push(Math.abs(r[t]-n[t]));return Math.min.apply(null,u)}function o(r,n){var t,e=r.length,u=0;for(t=0;e>t;t++)u+=r[t]===n[t]?0:1;return u}var a={version:"0.1.0"};a.crp=function(){function n(r,n){for(var t=r.length,e=0;t>e;++e)r[e]=n}function t(r){var n=c*g;v=r,m=new Float32Array(n),s=new Uint8Array(c),d=new Uint8Array(c),w=!0,y=new ArrayBuffer(4*n),j=new Uint8ClampedArray(y),b=new Uint32Array(y),q.globalCompositeOperation="source-over",q.imageSmoothingEnabled=!1,C.imageSmoothingEnabled=!1,p=C.getImageData(0,0,c,g)}function e(r,n){return c=n.x.length,g=n.y.length,A=document.createElement("canvas"),A.width=c,A.height=g,C=A.getContext("2d"),x=r.append("canvas").attr("width",U).attr("height",H).node(),q=x.getContext("2d"),q.translate(0,x.height),q.scale(1,-1),t(n),f(),i(),e}function u(){p.data.set(j),C.putImageData(p,0,0),M=!1}function o(){m=r(m,v,I),n(d,0),a.toimg(m,b,c,g,E,d),w=!1,M=!0}function i(){w===!0&&o(),M===!0&&u();var r=h.domain(),n=h.range(),t=l.domain(),e=l.range();q.clearRect(0,0,x.width,x.height),q.drawImage(A,r[0],t[0],r[1]-r[0],t[1]-t[0],n[0],e[0],n[1]-n[0],e[1]-e[0])}function f(){h=d3.scale.linear().domain([0,c]).range([0,U]),l=d3.scale.linear().domain([0,g]).range([0,H])}var h,l,c,g,s,d,v=null,m=null,w=!0,p=null,y=null,j=null,b=null,x=null,A=null,M=!0,q=null,C=null,E=.5,I=a.norms.l2,U=100,H=100;return e.rqa=function(){return m?a.rqa(m,v.x.length,E):void 0},e.epsnet=function(){return d},e.patternHighlight=function(r){if(M=!0,!arguments.length||!r)return i(),s;n(s,0);for(var t,e,u,o,a=b,f=m,h=[255,0,0],l=0;g-1>l;l++)for(var d=l+1;c>d;d++)t=c*l+d,e=c*d+l,o=f[t]<=E?255:0,u=2===r[t],u&&(s[d]=s[l]=1),a[t]=u?255<<24|.5*(o+h[2])<<16|.5*(o+h[1])<<8|.5*(o+h[0]):255<<24|o<<16|o<<8|o,a[e]=a[t];return i(),s},e.resetHighlight=function(){return M=!0,n(s,0),a.toimg(m,b,c,g,E,d),i(),s},e.boxHighlight=function(r){if(M=!0,!arguments.length)return i(),s;n(s,0);var t,e,u,o,a,f=r[0][0]-.5,h=r[0][1]-.5,l=r[1][0]-.5,d=r[1][1]-.5,v=b,w=m,p=[255,0,0];for(o=0;g>o;o++)for(a=0;c>a;a++)t=c*o+a,u=w[t]<=E?255:0,e=!(h>o||o>d||f>a||a>l),e&&(s[a]=s[o]=1),v[t]=e===!0?255<<24|.5*(u+p[2])<<16|.5*(u+p[1])<<8|.5*(u+p[0]):255<<24|u<<16|u<<8|u;return i(),s},e.update=function(){return null!==v&&i(),e},e.distfn=function(r){if(!arguments.length)return I;var n=typeof r;return"string"===n?(I="undefined"!==a.norms[r]?a.norms[r]:a.norms.l2,w=!0):"function"===n?(I=r,w=!0):(console.warn("Incorrect form of the distance function!"),console.warn("Reverting back to the default, Euclidean distance")),e},e.eps=function(r){return arguments.length?(E=+r,w=!0,e):E},e.width=function(r){return arguments.length?(U=+r,e):U},e.height=function(r){return arguments.length?(H=+r,e):H},e.scale=function(r){return arguments.length?(h=r.xs(),l=r.ys(),e):{xs:h,ys:l}},e.distanceMatrix=function(){return m},e.data=function(r){return arguments.length?(c=r.x.length,g=r.y.length,C.clearRect(0,0,A.width,A.height),A.width=c,A.height=g,t(r),e):v},e.highlight=function(r){if(M=!0,!arguments.length||!r)return i(),void 0;for(var n,t,e,u,o=b,a=m,f=[255,0,0],h=0;g>h;h++)for(var l=h;c>l;l++)n=c*h+l,t=c*l+h,u=a[n]<=E?255:0,e=1===r[h]&&1===r[l],o[n]=e===!0?255<<24|.5*(u+f[2])<<16|.5*(u+f[1])<<8|.5*(u+f[0]):255<<24|u<<16|u<<8|u,o[t]=o[n];i()},e},a.toimg=function(r,n,t,e,u,o){var a,i,f,h,l;for(a=0;e-1>a;a++)for(n[a*t+a]=-1,i=a+1;t>i;i++)f=a*t+i,l=r[f]<=u?255:0,l>0&&(o[a]=1,o[i]=1),n[f]=255<<24|l<<16|l<<8|l,h=i*t+a,n[h]=n[f];n[a*t+a]=-1},a.norms={l1:n,l2:t,max:e,min:u,edit:o},a.rqa=function(r,n,t){var e,u,o,a,g,s,d,m,w,p=1,y=1,j=v(r,t),b=f(j,n),x=stat.uint8ArrayCopy(j),A=stat.uint8ArrayCopy(j),q=h(j,n),C=l(x,n),E=(c(A,n),M(stat.uint8ArrayCopy(j),n,10,10)),I=2*b/(n*n-n),U=0,H=0,R=0,D=0;for(e=0;n>e;e++)p>e?U+=(e+1)*q[e]:R+=q[e];for(e=0;n>e;e++)y>e?H+=(e+1)*C[e]:D+=C[e];o=b?(b-U)/b:0,d=b?(b-H)/b:0,g=R?(b-U)/R:0,m=D?(b-H)/D:0,s=i(q),w=i(C);var S=0;for(e=p;n>e;e++)u=q[e],u>0&&(S+=u/R*Math.log(u/R));return a=-S,{rr:I,det:o,entropy:a,l:g,lmax:s,lam:d,tt:m,vmax:w,dl:j,vl:x,hl:A,dsq:E.dsq/(2*b),odr:E.odr/(2*b)}},a.rr=function(r,n,t){var e=v(r,t);return f(e,n)/(n*n-n)},a.det=function(r,n,t){var e=v(r,t),u=h(e,n),o=f(e,n);return(o-2*u[0])/o},a.entropy=function(r,n,t){for(var e,u=v(r,t),o=h(u,n),a=0,i=2,f=i-1,l=0;f<o.length;f++)a+=o[f];for(f=i-1;f<o.length;f++)e=o[f],e>0&&(l+=e/a*Math.log(e/a));return-l};var i=function(r){var n,t=r.length;for(n=t-1;n>=0;n--)if(r[n])return n+1},f=function(r,n){var t,e,u=0;for(t=0;n-1>t;t++)for(e=t+1;n>e;e++)u+=r[t*n+e];return u},h=function(r,n){var t,e,u,o,a=stat.uint32Array(n,0);for(e=0;n-1>e;e++)for(u=e+1;n>u;u++)o=e*n+u,1===r[o]&&(r[o]=0,t=1,t+=d(r,e+1,u+1,n),r[o]=t>1?2:0,a[t-1]++);return a},l=function(r,n){var t,e,u,o,a=stat.uint32Array(n,0);for(e=0;n-1>e;e++)for(u=e+1;n>u;u++)o=e*n+u,1===r[o]&&(r[o]=0,t=1,t+=s(r,e+1,u,n),r[o]=t>1?2:0,a[t-1]++);return a},c=function(r,n){var t,e,u,o,a=stat.uint32Array(n,0);for(e=0;n-1>e;e++)for(u=e+1;n>u;u++)o=e*n+u,1===r[o]&&(t=1,r[o]=0,t+=g(r,e,u+1,n),r[o]=t>1?2:0,a[t-1]++);return a},g=function(r,n,t,e){for(var u,o=e-t,a=0,i=0;o>i&&(u=n*e+t,1===r[u]);i++,t++)a++,r[u]=2;return a},s=function(r,n,t,e){var u,o,a=t-n,i=0;for(u=0;a>u&&(o=n*e+t,1===r[o]);u++,n++)i++,r[o]=2;return i},d=function(r,n,t,e){for(var u,o=e-t,a=0,i=0;o>i&&(u=n*e+t,1===r[u]);i++,n++,t++)a++,r[u]=2;return a},v=function(r,n){for(var t=r.length,e=stat.uint8Array(t,0),u=0;t>u;u++)e[u]=r[u]<=n?1:0;return e},m=function(r){var n,t=0,e=r.length;for(n=0;e>n;n++)t+=r[n].w*r[n].h;return t},w=function(r,n,t,e,u,o){var a,i=t+u,f=e+o,h=(i-1)*n;if(i>n||f>n)return!1;for(a=e;f>a;a++)if(r[h+a]<=0)return!1;return!0},p=function(r,n,t,e,u,o){var a,i=t+u,f=e+o,h=f-1;if(i>n||f>n)return!1;for(a=t;i>a;a++)if(r[a*n+h]<=0)return!1;return!0},y=function(r,n,t,e,u,o){var a,i=t+u,f=e+o,h=(i-1)*n,l=f-1;if(i>n||f>n)return!1;for(a=t;i>a;a++)if(r[a*n+l]<=0)return!1;for(a=e;f-1>a;a++)if(r[h+a]<=0)return!1;return!0},j=function(r,n,t,e,u,o,a){var i,f,h=t+u,l=e+o;for(i=t;h>i;i++)for(f=e;l>f;f++)r[i*n+f]=a},b=function(r,n,t,e,u,o){var a,i,f=t+u,h=e+o;if(h>n||f>n)return!1;for(a=t;f>a;a++)for(i=e;h>i;i++)if(r[a*n+i]<=0)return!1;return!0},x=function(r,n,t){for(var e=t,u=t,o=[],a={},i=0,f=0,h=0,l=!1;n-t>=f;)b(r,n,f,h,u,e)?(l=!0,a.i=f,a.j=h,a.w=e,a.h=u,e+=1,u=e):l?(o.push({i:a.i,j:a.j,h:a.h,w:a.w}),j(r,n,a.i,a.j,a.h,a.w,0),h=a.j+a.w,f=i=h,u=e=t,l=!1):(h=f=++i,u=e=t);return l&&o.push({i:a.i,j:a.j,h:a.h,w:a.w}),o},A=function(r,n,t,e){for(var u,o=[b,y,p,w],a=[],i={},f={},h={},l=t,c=e,g=!1,s=0,d=0,v=0;n-e>s;)o[v](r,n,s,d,c,l)?(g=!0,i.i=s,i.j=d,i.w=l,i.h=c,0===v||1===v?(l+=1,c+=1,v=1):2===v?l+=1:3===v&&(c+=1)):g?3===v?(u=i,h.w&&h.h&&(u=h.w*h.h>i.w*i.h?h:i),a.push({i:u.i,j:u.j,h:u.h,w:u.w}),j(r,n,u.i,u.j,u.h,u.w,0),g=!1,v=0,s=u.i,d=u.j+u.w,d>n-t&&(d=0,++s),l=t,c=e):1===v?(f.i=i.i,f.j=i.j,f.h=i.h,f.w=i.w,l=f.w+1,c=f.h,v=2):2===v&&(h.i=i.i,h.j=i.j,h.w=i.w,h.h=i.h,s=f.i,d=f.j,c=f.h+1,l=f.w,v=3):(++d,d>n-t&&(d=0,++s),v=0,l=t,c=e);return g&&(u=h.w*h.h>i.w*i.h?h:i,a.push({i:u.i,j:u.j,h:u.h,w:u.w})),a},M=function(r,n,t,e){var u=e||5,o=t||5;return{dsq:m(x(r,n,o)),odr:m(A(r,n,o,u))}};"function"==typeof define&&define.amd?define(a):"object"==typeof module&&module.exports?module.exports=a:this.rep=a}();